{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "WarrantProof Ledger Schema",
  "description": "Schema for WarrantProof receipt ledger - SIMULATION ONLY - OMEGA v3",
  "version": "3.0.0",
  "disclaimer": "THIS IS A SIMULATION. NOT REAL DoD DATA. FOR RESEARCH ONLY.",

  "omega_version": "3.0.0",
  "omega_features": [
    "Kolmogorov complexity (replaces Shannon entropy)",
    "Recursive ZK-SNARKs (Mina-style IVC)",
    "RAF network cycle detection",
    "Data Availability Sampling",
    "Adversarial robustness (PGD)",
    "USASpending ETL integration",
    "Layout entropy analysis",
    "SAM.gov CA validation"
  ],

  "hash_strategy": {
    "algorithm": ["SHA256", "BLAKE3"],
    "format": "sha256hex:blake3hex",
    "description": "Dual-hash per CLAUDEME §8"
  },

  "merkle_strategy": {
    "algorithm": "BLAKE3",
    "tree_type": "binary",
    "empty_hash": "dual_hash(b'empty')"
  },

  "receipt_types": {
    "warrant": {
      "description": "Cryptographic attestation for military transactions",
      "required_fields": ["transaction_id", "branch", "approver", "amount_usd"],
      "optional_fields": ["vendor", "program", "decision_lineage"],
      "citation_required": true
    },
    "quality_attestation": {
      "description": "Quality certification receipt",
      "required_fields": ["item", "inspector", "certification"],
      "optional_fields": ["branch", "decision_lineage"],
      "citation_required": true
    },
    "milestone": {
      "description": "Program milestone receipt",
      "required_fields": ["program", "milestone", "status"],
      "optional_fields": ["branch", "decision_lineage"],
      "citation_required": true
    },
    "cost_variance": {
      "description": "Cost overrun tracking receipt",
      "required_fields": ["program", "baseline_usd", "actual_usd", "variance_pct"],
      "optional_fields": ["branch", "severity", "decision_lineage"],
      "citation_required": true
    },
    "anchor": {
      "description": "Merkle anchor receipt",
      "required_fields": ["merkle_root", "batch_size"],
      "optional_fields": ["branch_scope", "receipt_types"],
      "citation_required": false
    },
    "detection": {
      "description": "Anomaly detection receipt",
      "required_fields": ["anomaly_type", "severity", "confidence"],
      "optional_fields": ["affected_receipts", "pattern_matched"],
      "citation_required": true
    },
    "compression": {
      "description": "Entropy-based analysis receipt",
      "required_fields": ["compression_ratio", "entropy_score", "classification"],
      "optional_fields": ["coherence_score", "fraud_likelihood"],
      "citation_required": true
    },
    "lineage": {
      "description": "Decision chain reconstruction receipt",
      "required_fields": ["target_receipt", "root_decision", "approval_chain"],
      "optional_fields": ["depth", "gaps_detected"],
      "citation_required": false
    },
    "bridge": {
      "description": "Cross-system translation receipt",
      "required_fields": ["source_system", "target_system", "translation_proof"],
      "optional_fields": ["information_preserved"],
      "citation_required": false
    },
    "simulation": {
      "description": "Scenario validation receipt",
      "required_fields": ["scenario", "passed", "results"],
      "optional_fields": ["criteria", "cycles_run"],
      "citation_required": true
    },
    "anomaly": {
      "description": "Stoprule violation receipt",
      "required_fields": ["metric", "delta", "action"],
      "optional_fields": ["classification", "baseline"],
      "citation_required": false
    },
    "violation": {
      "description": "Constraint violation receipt",
      "required_fields": ["metric", "action"],
      "optional_fields": ["delta", "classification"],
      "citation_required": false
    },
    "alert": {
      "description": "Real-time alert receipt",
      "required_fields": ["anomaly_type", "severity"],
      "optional_fields": ["confidence", "escalate"],
      "citation_required": true
    },
    "ingest": {
      "description": "Ledger ingestion receipt",
      "required_fields": ["ingested_receipt_id", "ingested_receipt_type"],
      "optional_fields": [],
      "citation_required": false
    },
    "verification": {
      "description": "Chain verification receipt",
      "required_fields": ["verified", "receipt_count"],
      "optional_fields": ["errors", "merkle_root"],
      "citation_required": false
    },

    "kolmogorov": {
      "description": "OMEGA v3: Kolmogorov complexity analysis receipt",
      "required_fields": ["kolmogorov_ratio", "is_fraud", "compression_algorithm"],
      "optional_fields": ["original_size", "compressed_size", "threshold"],
      "citation_required": true,
      "omega_module": "kolmogorov.py"
    },
    "zkp": {
      "description": "OMEGA v3: Zero-knowledge proof verification receipt",
      "required_fields": ["proof_valid", "proof_size_bytes", "circuit_type"],
      "optional_fields": ["public_inputs", "recursive_depth", "verification_time_ms"],
      "citation_required": true,
      "omega_module": "zkp.py"
    },
    "raf": {
      "description": "OMEGA v3: RAF network cycle detection receipt",
      "required_fields": ["cycles_detected", "keystone_species"],
      "optional_fields": ["cycle_lengths", "catalytic_links", "disruption_impact"],
      "citation_required": true,
      "omega_module": "raf.py"
    },
    "das": {
      "description": "OMEGA v3: Data availability sampling receipt",
      "required_fields": ["available", "confidence", "samples_checked"],
      "optional_fields": ["sample_rate", "erasure_detected", "chunk_count"],
      "citation_required": true,
      "omega_module": "das.py"
    },
    "adversarial": {
      "description": "OMEGA v3: Adversarial robustness test receipt",
      "required_fields": ["attack_type", "epsilon", "robust"],
      "optional_fields": ["perturbation_norm", "success_rate", "iterations"],
      "citation_required": true,
      "omega_module": "adversarial.py"
    },
    "usaspending": {
      "description": "OMEGA v3: USASpending ETL receipt",
      "required_fields": ["records_fetched", "endpoint", "fiscal_year"],
      "optional_fields": ["missing_fields", "pagination_offset", "api_version"],
      "citation_required": true,
      "omega_module": "usaspending_etl.py"
    },
    "layout_entropy": {
      "description": "OMEGA v3: PDF layout entropy analysis receipt",
      "required_fields": ["layout_entropy", "is_suspicious", "analysis_type"],
      "optional_fields": ["scan_artifacts", "perfect_alignment", "font_consistency"],
      "citation_required": true,
      "omega_module": "layout_entropy.py"
    },
    "sam_validation": {
      "description": "OMEGA v3: SAM.gov entity validation receipt",
      "required_fields": ["entity_valid", "signature_verified", "ca_trust_score"],
      "optional_fields": ["na_fields_found", "expired", "excluded"],
      "citation_required": true,
      "omega_module": "sam_validator.py"
    },
    "catalytic": {
      "description": "OMEGA v3: Catalytic link detection receipt",
      "required_fields": ["total_catalytic_links", "links_by_type"],
      "optional_fields": ["confidence_by_type", "raf_integration"],
      "citation_required": true,
      "omega_module": "bridge.py"
    },
    "holographic_da": {
      "description": "OMEGA v3: Holographic detection with data availability",
      "required_fields": ["merkle_root", "fraud_detected", "data_availability"],
      "optional_fields": ["erasure_encoding", "detection_method"],
      "citation_required": true,
      "omega_module": "holographic.py"
    },
    "thompson_audit": {
      "description": "OMEGA v3: Thompson sampling audit selection receipt",
      "required_fields": ["selected_count", "total_contractors", "budget"],
      "optional_fields": ["actual_rate", "selected_sample", "exploration_exploitation_ratio"],
      "citation_required": true,
      "omega_module": "thompson.py"
    },
    "bekenstein": {
      "description": "OMEGA v3: Bekenstein bound validation receipt",
      "required_fields": ["amount_usd", "max_bits", "actual_bits", "bound_respected"],
      "optional_fields": ["violation_ratio", "data_size_bytes"],
      "citation_required": true,
      "omega_module": "ledger.py"
    }
  },

  "base_receipt_schema": {
    "type": "object",
    "required": ["receipt_type", "ts", "tenant_id", "payload_hash"],
    "properties": {
      "receipt_type": {
        "type": "string",
        "description": "Type of receipt"
      },
      "ts": {
        "type": "string",
        "format": "date-time",
        "description": "ISO8601 timestamp"
      },
      "tenant_id": {
        "type": "string",
        "default": "warrantproof-simulation",
        "description": "Tenant identifier for isolation"
      },
      "payload_hash": {
        "type": "string",
        "pattern": "^[a-f0-9]{64}:[a-f0-9]{64}$",
        "description": "SHA256:BLAKE3 dual-hash"
      },
      "simulation_flag": {
        "type": "string",
        "const": "THIS IS A SIMULATION. NOT REAL DoD DATA. FOR RESEARCH ONLY.",
        "description": "Required disclaimer"
      },
      "citation": {
        "type": "object",
        "properties": {
          "source": { "type": "string" },
          "url": { "type": "string", "format": "uri" },
          "detail": { "type": "string" },
          "date": { "type": "string" }
        }
      }
    }
  },

  "branch_enum": [
    "Navy",
    "Army",
    "AirForce",
    "Marines",
    "SpaceForce",
    "CoastGuard"
  ],

  "severity_enum": [
    "low",
    "medium",
    "high",
    "critical"
  ],

  "classification_enum": [
    "legitimate",
    "suspicious",
    "fraudulent"
  ],

  "anomaly_type_enum": [
    "ghost_vendor",
    "time_anomaly",
    "cost_cascade",
    "cert_fraud",
    "inventory_ghost",
    "compression_failure",
    "kolmogorov_anomaly",
    "zkp_verification_failed",
    "raf_cycle_detected",
    "data_unavailable",
    "adversarial_attack",
    "layout_entropy_anomaly",
    "sam_validation_failed",
    "catalytic_cycle",
    "bekenstein_violation"
  ],

  "storage": {
    "format": "jsonl",
    "file": "receipts.jsonl",
    "append_only": true,
    "description": "Append-only JSON lines format"
  },

  "slo_thresholds": {
    "warrant_generation_ms": 50,
    "scan_per_1000_ms": 100,
    "translation_ms": 200,
    "lineage_construction_ms": 500,
    "compression_legitimate_min": 0.80,
    "compression_fraud_max": 0.50,
    "detection_recall_min": 0.90,
    "false_positive_max": 0.05,
    "lineage_completeness_min": 0.95
  },

  "omega_slo_thresholds": {
    "kolmogorov_threshold": 0.65,
    "kolmogorov_legitimate_min": 0.75,
    "bekenstein_bits_per_dollar": 1e-6,
    "raf_cycle_min_length": 3,
    "raf_cycle_max_length": 5,
    "thompson_audit_budget": 0.05,
    "adversarial_epsilon": 0.01,
    "zkp_proof_size_bytes": 22000,
    "data_availability_sample_rate": 0.10,
    "layout_entropy_threshold": 1.0,
    "sam_ca_trust_threshold": 0.50,
    "zkp_verification_ms_max": 100,
    "catalytic_detection_f1_min": 0.80
  },

  "omega_constants": {
    "description": "OMEGA v3 physics-derived constants",
    "kolmogorov_threshold": {
      "value": 0.65,
      "derivation": "K(x) < 0.65 indicates templated/generated data"
    },
    "bekenstein_bits_per_dollar": {
      "value": 1e-6,
      "derivation": "S ≤ BEKENSTEIN_BITS_PER_DOLLAR × amount (holographic bound)"
    },
    "raf_cycle_bounds": {
      "min": 3,
      "max": 5,
      "derivation": "Corruption networks typically 3-5 entity cycles"
    },
    "zkp_proof_size": {
      "value": 22000,
      "derivation": "Mina-style constant 22KB IVC proof"
    }
  }
}
